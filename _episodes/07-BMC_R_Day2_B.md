---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 07-BMC_R_Day2_B.md in _episodes_rmd/
title: "Data Wrangling"
subtitle: "Day 2"
author: "Nicholas Ho, Richard Morris"
keypoints:
- FIXME
objectives:
- FIXME
questions: FIXME
source: Rmd
teaching: 50
exercises: 25
---



[Back to homepage](https://n-ho.github.io/bmc_r_workshop_2018/)

## Data wrangling

![](tidyr.jpg) #corrected here from tidyverse_website.png not sure if this is intended behavior TODO

So far, we've been using R's base functions to perform our data wrangling and manipulation. I would highly encourage you to learn to use the [tidyverse](https://www.tidyverse.org/) collection of data wrangling and visualisation tools. These are excellent tools that allows you to write elegent, legible code that gets your data into the right shape prior to analysis.


~~~
# load tidyverse
library(tidyverse)
~~~
{: .language-r}



~~~
── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──
~~~
{: .output}



~~~
✔ ggplot2 3.1.0     ✔ purrr   0.2.5
✔ tibble  1.4.2     ✔ dplyr   0.7.7
✔ tidyr   0.8.2     ✔ stringr 1.3.1
✔ readr   1.1.1     ✔ forcats 0.3.0
~~~
{: .output}



~~~
── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
~~~
{: .output}


## haven

 TODO add haven logo here

haven is a package within the tidyverse that allows you to read in data from different sources. For example, if our autism dataset was saved as an .sav file (SPSS), we can use `haven` to read that in.


~~~
# load haven
library(haven)
#autism.data.spss <- read_spss("data/autism_data.sav") #TODO LOAD THIS DATA????
~~~
{: .language-r}


Next, we'll step into one of the most popular tidyverse package called [dplyr](https://dplyr.tidyverse.org/).

## dpylr

TODO add hex-dplyr.jpeg

`dpylr` allows you to perform some of the most common data manipulation tasks you'll encounter in R. The background of the `dplyr` package is that it is a "grammar" of data manipulation and that its functions are a set of verbs.

You will also notice that the spelling follows British spelling rather than American (Hadley Wickham, author and maintainer of the tidyverse, is from New Zealand), but they can actually be used interchangeably. For example, `summarise()` and `summarize()` perform the same function.

### select()
The `select()` function allows you to pick or remove variables based on their names. Note that you do not use `"` nor `'` to wrap the column names as you would with a base R function


~~~
# select just the age, gender and result columns from autism.data
selected.autism.data <- select(autism.data, age, gender, result)
~~~
{: .language-r}



~~~
Error in select(autism.data, age, gender, result): object 'autism.data' not found
~~~
{: .error}



~~~
head(selected.autism.data)
~~~
{: .language-r}



~~~
Error in head(selected.autism.data): object 'selected.autism.data' not found
~~~
{: .error}



~~~
# select all columns except for ethnicity and country
selected.autism.data <- select(autism.data, -ethnicity, -country)
~~~
{: .language-r}



~~~
Error in select(autism.data, -ethnicity, -country): object 'autism.data' not found
~~~
{: .error}



~~~
head(selected.autism.data)
~~~
{: .language-r}



~~~
Error in head(selected.autism.data): object 'selected.autism.data' not found
~~~
{: .error}

The tidyverse allows you to pipe functions together to create a chain to data manipulations. This allows you to redirect the output of one function into another one. Those familiar with bash or *nix will be familiar with piping with `|`. Here, we use `%>%` to pipe.

This makes each step discrete and helps immensely with readability


~~~
autism.data %>% select(age, gender, result) %>% head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

Or let's make this more legible

~~~
autism.data %>%
  select(age, gender, result) %>%
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

Redirect the output of this chain of pipes into a new dataframe

~~~
autism.data %>%
  select(age, gender, result) -> selected.autism.data
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}


### filter()
The `filter()` function allows you to filter rows of your dataset that match some condition. We can also combine this with some of R' base functions. Here, we'll use `head()` to restrict the output number of rows

~~~
autism.data %>%
  filter(age == 17) %>%
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

Combine this with the `select()` function to select only the age, gender and country of the 17 year olds in the autism dataset

~~~
autism.data %>%
  filter(age == 17) %>%
  select(age, gender, country) %>%
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

What are the counts for countries of the 17 year olds in the autism dataset

~~~
autism.data %>%
  filter(age == 17) %>%
  select(country) %>%
  table()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

### arrange()
The `arrange()` function allows you to reorder the rows of your dataset

~~~
autism.data %>%
  arrange(age) %>%
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

### mutate()
The `mutate()` function adds new columns for your data set

~~~
autism.data %>%
  mutate(result_squared = result^2) %>%
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

You can also use `mutate()` to remove or edit existing columns

~~~
autism.data %>%
  mutate(age_desc = NULL, #remove column
         result = result + 1, # edit existing column
         agerank = rank(age)) %>% # add column
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

You can use the `transmute()` function to keep only the column you created

~~~
autism.data %>%
  transmute(agerank = rank(age)) %>%
  head()
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}


### summarise() and group_by()
The `summarise()` function reduces down multiple values into one summary statistic. To do so, we need to tell R which groups we're interested in summarising our data into. To do so, we need to use the `group_by()` function prior to calling `summarise()`

~~~
autism.data %>%
  group_by(Class.ASD) %>%
  summarise(meanage = mean(age, na.rm = TRUE),
            count = n())
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

You can group by more than one variable

~~~
autism.data %>%
  group_by(Class.ASD, gender) %>%
  summarise(mean.age = mean(age, na.rm = TRUE),
            max.age = max(age, na.rm = TRUE),
            min.age = min(age, na.rm = TRUE),
            count = n())
~~~
{: .language-r}



~~~
Error in eval(lhs, parent, parent): object 'autism.data' not found
~~~
{: .error}

## Quiz

1. Create a summary table for mean `result` for a grouping by gender, autism class and family history of autism

~~~
autism.data %>%

  # your code here
~~~
{: .language-r}


2. (Intermediate) Do the same as above and now arrange from the lowest mean `result` to the highest

~~~
autism.data %>%

  # your code here
~~~
{: .language-r}
